
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../analytical/">
      
      
        <link rel="next" href="../operational/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Triggers - Drought Anticipatory Action Analysis Package Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-aatriggers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Drought Anticipatory Action Analysis Package Docs" class="md-header__button md-logo" aria-label="Drought Anticipatory Action Analysis Package Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Drought Anticipatory Action Analysis Package Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Triggers
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Drought Anticipatory Action Analysis Package Docs" class="md-nav__button md-logo" aria-label="Drought Anticipatory Action Analysis Package Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Drought Anticipatory Action Analysis Package Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/load-forecasts-from-cds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loading Seasonal Forecasts from CDS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/run-full-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run full verification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/run-operational-monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run operational monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    How-To Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    How-To Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/run-locally-pixi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run locally with Pixi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/run-docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run with Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/setup-ssh-github/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Set up SSH & GitHub
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/hdc-credentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure HDC credentials
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manage dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/testing-and-linting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing & linting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/jupytext/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use Jupytext
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring process (for Met Services)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Explanation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Explanation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analytical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analytical
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Triggers
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Triggers
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pixi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pixi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arguments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arguments
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        _triggers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.brute_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        brute_force
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.compute_confusion_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_confusion_matrix
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.evaluate_grid_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluate_grid_metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.filter_triggers_by_window" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_triggers_by_window
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.find_optimal_triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_optimal_triggers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.get_trigger_metrics_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_trigger_metrics_dataframe
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.get_window_district" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_window_district
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        objective
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.run_pilot_districts_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_pilot_districts_metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.run_ready_set_brute_selection" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_ready_set_brute_selection
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.save_metrics_df" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_metrics_df
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operational
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pixi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pixi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arguments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arguments
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        _triggers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.brute_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        brute_force
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.compute_confusion_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_confusion_matrix
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.evaluate_grid_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluate_grid_metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.filter_triggers_by_window" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_triggers_by_window
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.find_optimal_triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_optimal_triggers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.get_trigger_metrics_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_trigger_metrics_dataframe
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.get_window_district" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_window_district
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        objective
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.run_pilot_districts_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_pilot_districts_metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.run_ready_set_brute_selection" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_ready_set_brute_selection
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#AA.helpers._triggers.save_metrics_df" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_metrics_df
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="module-aatriggers">Module: <code>AA.triggers</code></h1>
<p>Computes triggers for SPI or Dryspell, for a given country and <strong>vulnerability</strong> mode.</p>
<h2 id="usage">Usage</h2>
<h3 id="pixi">Pixi</h3>
<pre><code class="language-bash">pixi run python -m AA.triggers &lt;ISO&gt; &lt;SPI/DRYSPELL&gt; &lt;VULNERABILITY&gt;
</code></pre>
<h3 id="docker">Docker</h3>
<pre><code class="language-bash">docker run --rm \
  -e AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} \
  -e AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} \
  -e AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN} \
  aa-runner:latest \
  python -m AA.triggers &lt;ISO&gt; &lt;SPI/DRYSPELL&gt; &lt;VULNERABILITY&gt; \
  --data-path &lt;DATA_PATH&gt; --output-path &lt;OUTPUT_PATH&gt;
</code></pre>
<h2 id="arguments">Arguments</h2>
<ul>
<li><code>&lt;ISO&gt;</code>: 3-letter ISO code.</li>
<li><code>&lt;SPI/DRYSPELL&gt;</code>: Indicator family.</li>
<li><code>&lt;VULNERABILITY&gt;</code>:</li>
<li><code>GT</code> — General Triggers</li>
<li><code>NRT</code> — Non-Regret Triggers</li>
<li><code>TBD</code> — Save full list without filtering</li>
</ul>


<div class="doc doc-object doc-module">



<a id="AA.helpers._triggers"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.brute_force" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">brute_force</span><span class="p">(</span><span class="n">observations_val</span><span class="p">,</span> <span class="n">observations_bool</span><span class="p">,</span> <span class="n">prob_ready</span><span class="p">,</span> <span class="n">prob_set</span><span class="p">,</span> <span class="n">lead_time</span><span class="p">,</span> <span class="n">issue</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">filter_constraints</span><span class="p">,</span> <span class="n">min_return_period</span><span class="p">,</span> <span class="n">min_hit_rate</span><span class="p">,</span> <span class="n">min_success_rate</span><span class="p">,</span> <span class="n">max_failure_rate</span><span class="p">,</span> <span class="n">out_shape</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the objective function for a set of thresholds using vectorized operations.</p>
<p>This function computes the objective function across an array of forecast probabilities
(<code>prob_issue0</code>, <code>prob_issue1</code>) and observed values (<code>obs_val</code>, <code>obs_bool</code>).
The objective function is evaluated for a set of candidate trigger pairs (t1 and t2 ranging
between 0 and 1 with a 0.01 step). The trigger pair with the lowest score is extracted as well as the score value.</p>
<p>The function is optimized for parallel execution with <code>Numba</code>'s <code>guvectorize</code> decorator to perform
calculations efficiently across a grid of inputs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prob_issue0</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Forecast probabilities for the 'ready' stage.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prob_issue1</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Forecast probabilities for the 'set' stage.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obs_val</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array of observed continuous anomaly values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obs_bool</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array of observed binary event occurrences (0 or 1).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>leadtime</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Indicator period lead time (month).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>issue</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Forecast issue month.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Tolerance threshold for acceptable false alarms.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_constraints</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Flag to apply operational constraints (1 for yes, 0 for no).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_return_period</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Minimum acceptable return period (in years).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_hit_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Minimum acceptable hit rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_success_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Minimum acceptable success rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_failure_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Maximum acceptable failure rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_shape</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array with the same size as result used as a trick to define the dimension of result in the decorator.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array to store computed objective function value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The <code>result</code> array is updated in place with the objective value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function uses <code>Numba</code>'s <code>guvectorize</code> to enable fast parallel processing.</li>
<li>It computes various performance metrics (hit rate, false alarm rate, success rate, failure rate) based on the thresholds.</li>
<li>Constraints (if enabled) can penalize thresholds that don't satisfy operational limits.</li>
</ul>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.compute_confusion_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_confusion_matrix</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">out_shape</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes a confusion matrix using numpy for two np.arrays
true and pred.</p>
<p>Results are identical (and similar in computation time) to:
"from sklearn.metrics import confusion_matrix"</p>
<p>However, this function avoids the dependency on sklearn and
allows to use numba in nopython mode.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.evaluate_grid_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate_grid_metrics</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">probs_ready</span><span class="p">,</span> <span class="n">probs_set</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate all metrics over the entire grid using apply_ufunc.
The list of metrics is:
    [Correct Rejections, False Positives, False Negatives, Hits, Hit Rate, False Alarm Rate, Success Rate, Failure Rate, Return Period]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, containing numerical and categorical observations, with dimensions (district, time, category, index)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_ready</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, forecast probabilities for the ready month, with dimensions (district, time, category, index, issue)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_set</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, forecast probabilities for the set month</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>metrics_da</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, structured array with grid evaluations for all metrics</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.filter_triggers_by_window" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_triggers_by_window</span><span class="p">(</span><span class="n">df_leadtime</span><span class="p">,</span> <span class="n">probs_ready</span><span class="p">,</span> <span class="n">probs_set</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Filters and selects the best trigger pairs for each window by evaluating the trigger values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df_leadtime</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame, DataFrame containing lead time information and trigger values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_ready</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, dataset containing readiness probabilities.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_set</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, dataset containing set probabilities.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, dataset containing observation values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object, configuration parameters including requirements for HR, SR, and FR.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame, DataFrame containing the best trigger pairs for each window.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.find_optimal_triggers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_optimal_triggers</span><span class="p">(</span><span class="n">observations_val</span><span class="p">,</span> <span class="n">observations_bool</span><span class="p">,</span> <span class="n">prob_ready</span><span class="p">,</span> <span class="n">prob_set</span><span class="p">,</span> <span class="n">lead_time</span><span class="p">,</span> <span class="n">issue</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">filter_constraints</span><span class="p">,</span> <span class="n">min_return_period</span><span class="p">,</span> <span class="n">min_hit_rate</span><span class="p">,</span> <span class="n">min_success_rate</span><span class="p">,</span> <span class="n">max_failure_rate</span><span class="p">,</span> <span class="n">output_shape</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the optimal triggers pair by evaluating the objective function on each couple of
values of a 100 * 100 grid and selecting the minimizer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observations_val</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Time series of the observed rainfall values (or SPI).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observations_bool</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Time series of categorical observations for the specified category.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prob_ready</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Time series of forecast probabilities for the ready month.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prob_set</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Time series of forecast probabilities for the set month.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lead_time</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Lead time month.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>issue</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Issue month.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Tolerance threshold for acceptable false alarms.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_constraints</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Flag to apply operational constraints (1 for yes, 0 for no).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_return_period</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Minimum acceptable return period (in years).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_hit_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Minimum acceptable hit rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_success_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Minimum acceptable success rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_failure_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Maximum acceptable failure rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_shape</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array with expected output size for numba compilation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>best_triggers</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array of size 2 containing best triggers for Ready / Set.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_score</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Score (mainly hit rate) corresponding to the best triggers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.get_trigger_metrics_dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_trigger_metrics_dataframe</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">probs_ready</span><span class="p">,</span> <span class="n">probs_set</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute trigger metrics for a single district and save the results as a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, observations dataset containing 'bool', 'val', 'lead_time', and 'category' variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_ready</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, dataset containing readiness probabilities with 'prob' and 'issue' variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_set</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, dataset containing set probabilities with 'prob' variable.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str, output folder path to save the CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.get_window_district" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_window_district</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">district</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Determines which window (Window 1 or Window 2) an indicator belongs to for a given district.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.objective" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">objective</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">obs_val</span><span class="p">,</span> <span class="n">obs_bool</span><span class="p">,</span> <span class="n">prob_issue0</span><span class="p">,</span> <span class="n">prob_issue1</span><span class="p">,</span> <span class="n">leadtime</span><span class="p">,</span> <span class="n">issue</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">filter_constraints</span><span class="p">,</span> <span class="n">min_return_period</span><span class="p">,</span> <span class="n">min_hit_rate</span><span class="p">,</span> <span class="n">min_success_rate</span><span class="p">,</span> <span class="n">max_failure_rate</span><span class="p">,</span> <span class="n">penalty</span><span class="p">,</span> <span class="n">conf_matrix</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the objective function value for a given pair of thresholds.</p>
<p>This function evaluates a set of thresholds (t) applied to two forecast probability time series
(prob_issue0 and prob_issue1) to generate binary predictions. It then computes the confusion
matrix (misses, false alarms, false negatives, hits) and derives key performance metrics
such as hit rate, false alarm rate, success rate, failure rate, and return period.</p>
<p>If <code>filter_constraints</code> is True, it applies a set of operational constraints
(minimum hit rate, minimum success rate, maximum failure rate, minimum return period, and lead time constraint)
to determine if the thresholds are acceptable. If all constraints are satisfied,
it minimizes a combination of hit rate and false alarm rate; otherwise, it assigns a high penalty value.</p>
<p>If <code>filter_constraints</code> is False, it returns the full set of metrics without penalization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array of size 2 containing triggers for 'ready' and 'set' forecasts.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obs_val</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array of observed continuous anomaly values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obs_bool</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array of observed binary event occurrences (0 or 1).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prob_issue0</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Forecast probabilities for the 'ready' stage.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prob_issue1</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Forecast probabilities for the 'set' stage.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>leadtime</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Indicator period lead time (month).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>issue</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Forecast issue month.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Tolerance threshold for acceptable false alarms.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_constraints</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, If 1, constraints are applied to filter acceptable triggers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_return_period</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, Minimum acceptable return period for actions (in years).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_hit_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Minimum acceptable hit rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_success_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Minimum acceptable success rate (hits relative to actions taken).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_failure_rate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float, Maximum acceptable failure rate (tolerance-exceeding false alarms relative to actions taken).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>penalty</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array of penalty values assigned when constraints are not satisfied.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conf_matrix</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array to store computed confusion matrix elements [misses, false alarms, false negatives, hits].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraints</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array to temporarily store the boolean results of constraints evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray, Array to store the computed objective score or the list of metrics.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The first output when <code>filter_constraints=True</code> is a scalar combining hit rate and false alarm rate.</li>
<li>When <code>filter_constraints=False</code>, the full confusion matrix and performance metrics are returned.</li>
<li>Designed for use with Numba <code>guvectorize</code> to allow fast parallel evaluation across a large grid of thresholds.</li>
</ul>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.run_pilot_districts_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_pilot_districts_metrics</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">probs_ready</span><span class="p">,</span> <span class="n">probs_set</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Loop through pilot districts and save trigger metrics in CSV.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, observational dataset containing 'bool', 'val', 'lead_time', and 'category' variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_ready</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, dataset containing readiness probabilities with 'prob' and 'issue' variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_set</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, dataset containing set probabilities with 'prob' variable.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object, configuration parameters including 'data_path', 'iso', and 'districts_vulnerability'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.run_ready_set_brute_selection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_ready_set_brute_selection</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">probs_ready</span><span class="p">,</span> <span class="n">probs_set</span><span class="p">,</span> <span class="n">probs</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Run the trigger optimization using xarray's apply_ufunc and Dask parallelization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, dataset containing observed values ('val'), boolean event occurrence ('bool'), lead time ('lead_time'), tolerance ('tolerance'), and return period ('return_period').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_ready</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, dataset containing the forecast probability used for readiness ('prob').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs_set</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, dataset containing the forecast probability used for activation ('prob').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.Dataset, dataset containing the forecast issue time ('issue').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object, Params class containing 'vulnerability' and 'requirements' (with 'HR', 'SR', 'FR').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>triggers</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, array of optimal trigger pairs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>score</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, optimal score (- hit rate + alpha * false alarm rate) for each configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="AA.helpers._triggers.save_metrics_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_metrics_df</span><span class="p">(</span><span class="n">grid_metrics_da</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert grid metrics from a DataArray to a pivoted DataFrame and save it as a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>grid_metrics_da</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray.DataArray, containing the computed trigger metrics.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str, output folder path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>output_path</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str, output file path.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>